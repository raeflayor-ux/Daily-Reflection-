<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Reflection">
  <meta name="theme-color" content="#1e293b">
  <meta name="description" content="Daily Reflection Practice">
  <title>Daily Reflection</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231e293b' width='100' height='100' rx='12'/><path d='M50 25 L50 75' stroke='%23f97316' stroke-width='2'/><path d='M25 30 Q35 28 50 30 L50 72 Q35 70 25 72 Z' fill='%23ffffff' opacity='0.9'/><path d='M75 30 Q65 28 50 30 L50 72 Q65 70 75 72 Z' fill='%23ffffff' opacity='0.9'/><path d='M20 45 Q17 52 20 58 Q23 52 20 45' fill='%2306b6d4'/><path d='M80 45 Q77 52 80 58 Q83 52 80 45' fill='%2306b6d4'/><path d='M16 60 Q14 65 16 69 Q18 65 16 60' fill='%2306b6d4' opacity='0.7'/><path d='M84 60 Q82 65 84 69 Q86 65 84 60' fill='%2306b6d4' opacity='0.7'/></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231e293b' width='100' height='100'/><path d='M50 20 L50 80' stroke='%23f97316' stroke-width='3'/><path d='M20 26 Q35 24 50 26 L50 76 Q35 74 20 76 Z' fill='%23ffffff' opacity='0.95'/><path d='M80 26 Q65 24 50 26 L50 76 Q65 74 80 76 Z' fill='%23ffffff' opacity='0.95'/><path d='M12 42 Q8 52 12 62 Q16 52 12 42' fill='%2306b6d4'/><path d='M88 42 Q84 52 88 62 Q92 52 88 42' fill='%2306b6d4'/><path d='M8 58 Q5 66 8 72 Q11 66 8 58' fill='%2306b6d4' opacity='0.7'/><path d='M92 58 Q89 66 92 72 Q95 66 92 58' fill='%2306b6d4' opacity='0.7'/></svg>">
  <link rel="manifest" href="data:application/json,{%22name%22:%22Daily%20Reflection%22,%22short_name%22:%22Reflection%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22%231e293b%22,%22theme_color%22:%22%231e293b%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231e293b' width='100' height='100'/><text y='.68em' x='50' text-anchor='middle' font-size='50'>üìñ</text></svg>%22,%22sizes%22:%22any%22,%22type%22:%22image/svg+xml%22}]}">
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    html, body { min-height: 100vh; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); }
    input, textarea, button, select { font-family: inherit; }
    input:focus, textarea:focus, select:focus { outline: 2px solid #f97316; outline-offset: 2px; }
    button { cursor: pointer; border: none; transition: all 0.15s ease; }
    button:active { transform: scale(0.98); }
    
    .header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 16px; position: sticky; top: 0; z-index: 10; }
    .header h1 { font-size: 20px; font-weight: 700; text-align: center; }
    .header p { font-size: 12px; color: #94a3b8; text-align: center; margin-top: 4px; }
    .header .icon-row { font-size: 20px; text-align: center; margin: 4px 0; }
    
    .tabs { display: flex; background: white; position: sticky; top: 88px; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .tab { flex: 1; padding: 14px 8px; background: transparent; font-size: 13px; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; }
    .tab.active { border-bottom-color: var(--tab-color); color: var(--tab-color); background: color-mix(in srgb, var(--tab-color) 7%, transparent); }
    
    .content { padding: 16px; padding-bottom: 100px; }
    
    .version-toggle { display: flex; justify-content: center; gap: 8px; margin-bottom: 16px; }
    .version-btn { padding: 10px 20px; border-radius: 20px; font-weight: 700; font-size: 13px; text-transform: uppercase; background: #e2e8f0; color: #64748b; }
    .version-btn.active { color: white; }
    
    .section { background: white; border-radius: 16px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 4px solid var(--section-color); }
    .section h3 { font-size: 12px; font-weight: 700; color: var(--section-color); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
    
    .label { display: block; font-size: 13px; font-weight: 600; color: #334155; margin-bottom: 8px; }
    .input, .textarea, .select { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 16px; margin-bottom: 12px; }
    .select { background: white; }
    .textarea { resize: vertical; font-family: inherit; min-height: 60px; }
    
    .btn-row { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; }
    .sleep-btn { padding: 8px 10px; border-radius: 8px; font-weight: 600; font-size: 13px; background: #f1f5f9; color: #475569; min-width: 32px; }
    .sleep-btn.active { background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%); color: white; }
    
    .rating-btn { width: 32px; height: 32px; border-radius: 8px; font-weight: 700; font-size: 13px; background: #f1f5f9; color: #475569; }
    .rating-btn.active { background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: white; transform: scale(1.1); }
    
    .yesno-row { display: flex; gap: 12px; justify-content: center; }
    .yes-btn, .no-btn { padding: 12px 24px; border-radius: 12px; font-weight: 700; background: #f1f5f9; color: #475569; }
    .yes-btn.active { background: linear-gradient(135deg, #22c55e 0%, #10b981 100%); color: white; }
    .no-btn.active { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); color: white; }
    
    .domain-chips { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .domain-chip { padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 13px; background: #f1f5f9; color: #475569; }
    .domain-chip.active { color: white; }
    
    .workmode-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .workmode-btn { padding: 8px 14px; border-radius: 10px; font-weight: 600; font-size: 13px; text-transform: capitalize; background: #f1f5f9; color: #475569; }
    .workmode-btn.active { background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%); color: white; }
    
    .repair-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .repair-btn { padding: 10px 16px; border-radius: 10px; font-weight: 600; font-size: 13px; background: #f1f5f9; color: #475569; }
    .repair-btn.active { background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: white; }
    
    .highlight-box { margin-top: 16px; background: #fff7ed; border: 2px solid #f97316; border-radius: 12px; padding: 14px; }
    .highlight-box.yellow { background: #fefce8; border-color: #fbbf24; }
    
    .flex-row { display: flex; gap: 8px; }
    .flex-row > div { flex: 1; }
    
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }
    .mb-8 { margin-bottom: 8px; }
    
    .timestamp { font-size: 11px; color: #94a3b8; text-align: center; margin-top: 8px; }
    
    .footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 12px 16px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 10; }
    .footer-inner { display: flex; gap: 12px; max-width: 500px; margin: 0 auto; }
    .clear-btn { padding: 14px 20px; border-radius: 12px; font-weight: 600; background: #e2e8f0; color: #475569; }
    .copy-btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 700; background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%); color: white; }
    .copy-btn.copied { background: #22c55e; }
    .cancel-btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 600; background: #e2e8f0; color: #475569; }
    .confirm-btn { flex: 1; padding: 14px; border-radius: 12px; font-weight: 700; background: #ef4444; color: white; }
    
    .hidden { display: none !important; }
    
    .offline-badge { display: none; font-size: 10px; background: #22c55e; color: white; padding: 2px 8px; border-radius: 10px; margin-left: 8px; }
    .offline-ready .offline-badge { display: inline; }
  </style>
</head>
<body>
  <div class="header">
    <h1>DRIP</h1>
    <p style="font-size: 11px; color: #94a3b8; text-align: center; margin-top: 2px; font-style: italic;">Daily Reflection & Intention Practice</p>
    <p class="icon-row">üíßüìñüíß</p>
    <p id="header-date"></p>
  </div>
  
  <div class="tabs">
    <button class="tab active" data-tab="morning" style="--tab-color: #14b8a6;">‚òÄÔ∏è Morning Intention</button>
    <button class="tab" data-tab="moment" style="--tab-color: #a855f7;">‚ö° Moment Capture</button>
    <button class="tab" data-tab="nightly" style="--tab-color: #6366f1;">üåô Nightly Reflection</button>
  </div>
  
  <div class="content">
    <!-- MORNING TAB -->
    <div id="morning-tab" class="tab-content">
      <div class="version-toggle">
        <button class="version-btn active" data-version="core" data-target="morning" style="background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%); color: white;">Core</button>
        <button class="version-btn" data-version="full" data-target="morning">Full</button>
      </div>
      
      <div class="section" style="--section-color: #14b8a6;">
        <h3>Grounding</h3>
        <label class="label">Date</label>
        <input type="text" class="input" id="m-date">
        <label class="label">Day of the Week</label>
        <select class="select" id="m-day-of-week">
          <option value="">Select...</option>
          <option value="Sunday">Sunday</option>
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
          <option value="Saturday">Saturday</option>
        </select>
        <label class="label">Hours of Sleep</label>
        <div class="btn-row" id="m-sleep-btns"></div>
        <div class="mt-16">
          <label class="label">One word for how I woke up</label>
          <input type="text" class="input" id="m-woke-word" placeholder="e.g., rested, exhausted, motivated...">
        </div>
        <div class="mt-16">
          <label class="label">Is there something this morning you're already proud of or grateful for?</label>
          <textarea class="textarea" id="m-morning-pride" placeholder="Optional..." rows="2"></textarea>
        </div>
      </div>
      
      <div class="section" style="--section-color: #f97316;">
        <h3>Orientation</h3>
        <label class="label">What domain(s) are asking for attention?</label>
        <div class="domain-chips" id="m-domains"></div>
        <div class="highlight-box">
          <label class="label">‚≠ê What's the ONE thing that makes today a win?</label>
          <textarea class="textarea" id="m-one-thing" placeholder="Be specific. Give it teeth." rows="3"></textarea>
        </div>
        <div class="highlight-box">
          <label class="label">üìÖ What action/calendar item emerged?</label>
          <textarea class="textarea" id="m-action-item" placeholder="The concrete thing that goes on the list" rows="2"></textarea>
        </div>
        <div class="mt-16">
          <label class="label">What else is present? (Musing space)</label>
          <textarea class="textarea" id="m-others" placeholder="Whatever's floating around in your mind right now..." rows="3"></textarea>
        </div>
      </div>
      
      <!-- FULL VERSION SECTIONS -->
      <div id="morning-full" class="hidden">
        <div class="section" style="--section-color: #22c55e;">
          <h3>Body Awareness</h3>
          <label class="label">Physical sensation right now</label>
          <input type="text" class="input" id="m-physical-sensation">
          <label class="label">Where am I holding tension?</label>
          <input type="text" class="input" id="m-holding-tension">
        </div>
        
        <div class="section hidden" id="m-relational-section" style="--section-color: #ec4899;">
          <h3>Relational</h3>
          <label class="label">Who needs me present, and what does present look like?</label>
          <textarea class="textarea" id="m-relational-present"></textarea>
          <label class="label">What's likely to pull me out? My plan?</label>
          <textarea class="textarea" id="m-relational-plan"></textarea>
        </div>
        
        <div class="section hidden" id="m-creative-section" style="--section-color: #a855f7;">
          <h3>Creative</h3>
          <label class="label">What do I want to make/capture/move forward?</label>
          <textarea class="textarea" id="m-creative-what"></textarea>
          <label class="label">When will I protect time for it? (Timestamp it)</label>
          <input type="text" class="input" id="m-creative-when" placeholder="e.g., 9pm after kids are down">
        </div>
        
        <div class="section hidden" id="m-professional-section" style="--section-color: #3b82f6;">
          <h3>Professional</h3>
          <label class="label">Where is curiosity asking me to lean in today?</label>
          <textarea class="textarea" id="m-professional-hardest" placeholder="What's pulling your attention? Where could curiosity lead?"></textarea>
          <label class="label">Where could I coast but won't?</label>
          <textarea class="textarea" id="m-professional-coast"></textarea>
        </div>
        
        <div class="section hidden" id="m-physical-section" style="--section-color: #22c55e;">
          <h3>Physical</h3>
          <label class="label">What's my body asking for?</label>
          <textarea class="textarea" id="m-physical-asking"></textarea>
          <label class="label">Intentional movement‚Äîwhat and when?</label>
          <input type="text" class="input" id="m-physical-when">
        </div>
        
        <div class="section hidden" id="m-financial-section" style="--section-color: #f59e0b;">
          <h3>Financial</h3>
          <label class="label">What money-related action have I been avoiding?</label>
          <textarea class="textarea" id="m-financial-avoiding"></textarea>
          <label class="label">What would stewardship look like today?</label>
          <textarea class="textarea" id="m-financial-stewardship"></textarea>
        </div>
        
        <div class="section" style="--section-color: #64748b;">
          <h3>Anticipation</h3>
          <label class="label">Where do I see myself being successful today?</label>
          <textarea class="textarea" id="m-success"></textarea>
          <label class="label">What will help me stay anchored?</label>
          <textarea class="textarea" id="m-anchored"></textarea>
        </div>
        
        <div class="section" style="--section-color: #6366f1;">
          <h3>Carry Forward</h3>
          <label class="label">What from last night do I want to hold onto or let go of?</label>
          <textarea class="textarea" id="m-carry-forward"></textarea>
        </div>
      </div>
    </div>
    
    <!-- MOMENT TAB -->
    <div id="moment-tab" class="tab-content hidden">
      <div class="section" style="--section-color: #a855f7;">
        <h3>Moment Capture</h3>
        <textarea class="textarea" id="moment-text" placeholder="What happened? What are you noticing?" rows="6"></textarea>
        <p class="timestamp" id="moment-timestamp"></p>
      </div>
    </div>
    
    <!-- NIGHTLY TAB -->
    <div id="nightly-tab" class="tab-content hidden">
      <div class="version-toggle">
        <button class="version-btn active" data-version="core" data-target="nightly" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white;">Core</button>
        <button class="version-btn" data-version="full" data-target="nightly">Full</button>
      </div>
      
      <div class="section" style="--section-color: #6366f1;">
        <h3>Core</h3>
        <label class="label">Date</label>
        <input type="text" class="input" id="n-date">
        <label class="label">Day of Week</label>
        <input type="text" class="input" id="n-day">
      </div>
      
      <div class="section" style="--section-color: #f97316;">
        <h3>Self-Rating</h3>
        <div class="highlight-box" style="margin-top: 0;">
          <label class="label">‚≠ê Showed up as the version of myself I want to be (1-10)</label>
          <div class="btn-row" id="n-self-rating-btns"></div>
          <div class="mt-12">
            <label class="label">Notes</label>
            <textarea class="textarea" id="n-self-rating-notes" placeholder="What shaped this rating?" rows="3"></textarea>
          </div>
        </div>
      </div>
      
      <div class="section" style="--section-color: #fbbf24;">
        <h3>The ONE Thing</h3>
        <div class="highlight-box yellow" style="margin-top: 0;">
          <label class="label">Did I do the ONE thing I named this morning?</label>
          <div class="yesno-row" id="n-did-one-thing"></div>
          <div class="mt-12 hidden" id="n-one-thing-yes">
            <label class="label">What made it possible?</label>
            <textarea class="textarea" id="n-what-made-possible" placeholder="What enabled success?"></textarea>
          </div>
          <div class="mt-12 hidden" id="n-one-thing-no">
            <label class="label">What got in the way?</label>
            <textarea class="textarea" id="n-what-got-in-way" placeholder="What blocked it?"></textarea>
          </div>
        </div>
      </div>
      
      <div class="section" style="--section-color: #a855f7;">
        <h3>Sitting With Me</h3>
        <label class="label">One sentence‚Äîwhat's sitting with me tonight?</label>
        <textarea class="textarea" id="n-sitting-with" placeholder="The one thing worth naming..." rows="3"></textarea>
      </div>
      
      <!-- NIGHTLY FULL VERSION -->
      <div id="nightly-full" class="hidden">
        <div class="section" style="--section-color: #22c55e;">
          <h3>Body Check</h3>
          <label class="label">Intentional movement?</label>
          <div class="yesno-row" id="n-movement"></div>
          <div class="mt-12 hidden" id="n-movement-details">
            <div class="flex-row mb-8">
              <div><label class="label">Type</label><input type="text" class="input" id="n-movement-type" placeholder="e.g., walk"></div>
              <div><label class="label">Duration</label><input type="text" class="input" id="n-movement-duration" placeholder="e.g., 30 min"></div>
            </div>
            <textarea class="textarea" id="n-movement-notes" placeholder="Notes..."></textarea>
          </div>
          <div class="mt-16">
            <label class="label">Ate well today? (1-10)</label>
            <div class="btn-row" id="n-ate-well-btns"></div>
            <input type="text" class="input mt-12" id="n-ate-well-notes" placeholder="Notes...">
          </div>
          <div class="mt-16">
            <label class="label">Mindfulness practice?</label>
            <div class="yesno-row" id="n-mindfulness"></div>
            <div class="mt-12 hidden" id="n-mindfulness-details">
              <label class="label">Quality (1-10)</label>
              <div class="btn-row" id="n-mindfulness-quality-btns"></div>
              <input type="text" class="input mt-12" id="n-mindfulness-notes" placeholder="Notes...">
            </div>
          </div>
          <div class="mt-16">
            <label class="label">Physical signals</label>
            <input type="text" class="input" id="n-physical-signals" placeholder="Headache, tension, fatigue, etc.">
          </div>
        </div>
        
        <div class="section" style="--section-color: #3b82f6;">
          <h3>Professional Confidence</h3>
          <label class="label">Work mode</label>
          <div class="workmode-row" id="n-workmode"></div>
          <div id="n-professional-fields">
            <div class="mt-16">
              <label class="label">Teaching confidence (1-10)</label>
              <div class="btn-row" id="n-teaching-btns"></div>
              <input type="text" class="input mt-12" id="n-teaching-notes" placeholder="Notes...">
            </div>
            <div class="mt-16">
              <label class="label">Leadership confidence (1-10)</label>
              <div class="btn-row" id="n-leadership-btns"></div>
              <input type="text" class="input mt-12" id="n-leadership-notes" placeholder="Notes...">
            </div>
          </div>
        </div>
        
        <div class="section" style="--section-color: #10b981;">
          <h3>Entrepreneurial</h3>
          <label class="label">Entrepreneurial confidence (1-10)</label>
          <div class="btn-row" id="n-entrepreneurial-btns"></div>
          <input type="text" class="input mt-12" id="n-entrepreneurial-notes" placeholder="Notes...">
          <div class="mt-16">
            <label class="label">Product Updates</label>
            <textarea class="textarea" id="n-product-updates" placeholder="Which products touched, progress, blockers..." rows="3"></textarea>
          </div>
        </div>
        
        <div class="section" style="--section-color: #ec4899;">
          <h3>Relational Presence</h3>
          <label class="label">Energy (1-10)</label>
          <div class="btn-row" id="n-energy-btns"></div>
          <input type="text" class="input mt-12" id="n-energy-notes" placeholder="Notes...">
          <div class="mt-16">
            <label class="label">Presence, patience, playfulness with kids (1-10)</label>
            <div class="btn-row" id="n-kids-btns"></div>
            <input type="text" class="input mt-12" id="n-kids-notes" placeholder="Notes...">
          </div>
          <div class="mt-16">
            <label class="label">Present and intentionally curious with wife (1-10)</label>
            <div class="btn-row" id="n-wife-btns"></div>
            <input type="text" class="input mt-12" id="n-wife-notes" placeholder="Notes...">
          </div>
          <div class="mt-16">
            <label class="label">Connected with a friend?</label>
            <div class="yesno-row" id="n-friend"></div>
            <div class="mt-12 hidden" id="n-friend-details">
              <div class="flex-row mb-8">
                <input type="text" class="input" id="n-friend-who" placeholder="Who?">
                <input type="text" class="input" id="n-friend-method" placeholder="Method">
              </div>
              <label class="label">What was the heart of the conversation?</label>
              <textarea class="textarea" id="n-friend-heart" placeholder="The substance of what you talked about..." rows="2"></textarea>
            </div>
          </div>
        </div>
        
        <div class="section" style="--section-color: #8b5cf6;">
          <h3>Passion Pursuits</h3>
          <label class="label">Music production?</label>
          <div class="yesno-row" id="n-music"></div>
          <div class="hidden" id="n-music-notes-wrap"><input type="text" class="input mt-12" id="n-music-notes" placeholder="Notes..."></div>
          <div class="mt-16">
            <label class="label">Writing?</label>
            <div class="yesno-row" id="n-writing"></div>
            <div class="hidden" id="n-writing-notes-wrap"><input type="text" class="input mt-12" id="n-writing-notes" placeholder="Notes..."></div>
          </div>
          <div class="mt-16">
            <label class="label">Captured something beautiful (photo/video)?</label>
            <div class="yesno-row" id="n-beautiful"></div>
            <div class="hidden" id="n-beautiful-notes-wrap"><input type="text" class="input mt-12" id="n-beautiful-notes" placeholder="Notes..."></div>
          </div>
        </div>
        
        <div class="section" style="--section-color: #64748b;">
          <h3>Interactions</h3>
          <label class="label">One interaction that lifted me (+ who)</label>
          <textarea class="textarea" id="n-lifted"></textarea>
          <div class="mt-16">
            <label class="label">One that cost me (+ who)</label>
            <textarea class="textarea" id="n-cost"></textarea>
          </div>
          <div class="mt-16" id="n-repair-section">
            <label class="label">Repaired?</label>
            <div class="repair-row" id="n-repair-status"></div>
            <div class="mt-12 hidden" id="n-repair-when-wrap">
              <label class="label">When?</label>
              <input type="text" class="input" id="n-repair-timing" placeholder="Same day / note date">
            </div>
            <div class="mt-12 hidden" id="n-repair-blocker-wrap">
              <label class="label">What's in the way?</label>
              <textarea class="textarea" id="n-repair-obstacle" placeholder="What's blocking the repair?" rows="2"></textarea>
            </div>
          </div>
          <div class="mt-16">
            <label class="label">Any prior "cost" interactions now repaired?</label>
            <textarea class="textarea" id="n-prior-repairs" placeholder="Note which + when (reference original date)..." rows="2"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <div class="footer-inner" id="footer-buttons">
      <button class="clear-btn" id="clear-btn">Clear</button>
      <button class="copy-btn" id="copy-btn">üìã Copy to Clipboard</button>
    </div>
    <div class="footer-inner hidden" id="footer-confirm">
      <button class="cancel-btn" id="cancel-btn">Cancel</button>
      <button class="confirm-btn" id="confirm-btn">Confirm Clear</button>
    </div>
  </div>

  <script>
    // Register Service Worker for offline support
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE_NAME = 'reflection-v2';
        self.addEventListener('install', e => {
          e.waitUntil(
            caches.open(CACHE_NAME).then(cache => cache.addAll(['/']))
          );
          self.skipWaiting();
        });
        self.addEventListener('activate', e => {
          e.waitUntil(self.clients.claim());
        });
        self.addEventListener('fetch', e => {
          e.respondWith(
            caches.match(e.request).then(r => r || fetch(e.request).then(res => {
              const clone = res.clone();
              caches.open(CACHE_NAME).then(cache => cache.put(e.request, clone));
              return res;
            }))
          );
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swUrl, { scope: '/' }).then(() => {
        document.body.classList.add('offline-ready');
      }).catch(() => {});
    }

    // State
    const state = {
      activeTab: 'morning',
      morningVersion: 'core',
      nightlyVersion: 'core',
      morning: { date: '', dayOfWeek: '', sleepHours: 7, wokeUpWord: '', morningPride: '', domains: [], oneThing: '', actionItem: '', others: '', physicalSensation: '', holdingTension: '', relationalPresent: '', relationalPlan: '', creativeWhat: '', creativeWhen: '', professionalHardest: '', professionalCoast: '', physicalAsking: '', physicalWhen: '', financialAvoiding: '', financialStewardship: '', success: '', anchored: '', carryForward: '' },
      moment: { text: '' },
      nightly: { date: '', dayOfWeek: '', selfRating: 7, selfRatingNotes: '', didOneThing: null, whatMadeItPossible: '', whatGotInTheWay: '', sittingWithMe: '', movement: null, movementType: '', movementDuration: '', movementNotes: '', ateWell: 7, ateWellNotes: '', mindfulness: null, mindfulnessQuality: 7, mindfulnessNotes: '', physicalSignals: '', workMode: '', teachingConfidence: 7, teachingNotes: '', leadershipConfidence: 7, leadershipNotes: '', entrepreneurialConfidence: 7, entrepreneurialNotes: '', productUpdates: '', energy: 7, energyNotes: '', kidsPresence: 7, kidsNotes: '', wifePresence: 7, wifeNotes: '', friendConnection: null, friendWho: '', friendMethod: '', friendHeart: '', musicProduction: null, musicNotes: '', writing: null, writingNotes: '', capturedBeautiful: null, beautifulNotes: '', liftedInteraction: '', costInteraction: '', repairStatus: '', repairTiming: '', repairObstacle: '', priorRepairs: '' }
    };

    // Date helpers
    function getDateInfo() {
      const now = new Date();
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      return {
        formatted: `${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`,
        dayOfWeek: days[now.getDay()],
        timestamp: now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })
      };
    }

    const dateInfo = getDateInfo();
    document.getElementById('header-date').textContent = dateInfo.formatted;
    document.getElementById('moment-timestamp').textContent = `${dateInfo.timestamp} ‚Äî will format as "Moment capture: ..."`;

    // Initialize dates
    if (!state.morning.date) state.morning.date = dateInfo.formatted;
    if (!state.morning.dayOfWeek) state.morning.dayOfWeek = dateInfo.dayOfWeek;
    if (!state.nightly.date) state.nightly.date = dateInfo.formatted;
    if (!state.nightly.dayOfWeek) state.nightly.dayOfWeek = dateInfo.dayOfWeek;

    // LocalStorage
    function saveState() {
      localStorage.setItem('justinReflectionDraft', JSON.stringify(state));
    }

    function loadState() {
      const saved = localStorage.getItem('justinReflectionDraft');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          // Merge saved data with current state structure to handle new fields
          if (data.morning) Object.assign(state.morning, data.morning);
          if (data.moment) Object.assign(state.moment, data.moment);
          if (data.nightly) Object.assign(state.nightly, data.nightly);
          if (data.activeTab) state.activeTab = data.activeTab;
          if (data.morningVersion) state.morningVersion = data.morningVersion;
          if (data.nightlyVersion) state.nightlyVersion = data.nightlyVersion;
        } catch (e) {}
      }
    }

    // Button generators
    function createSleepButtons(containerId, value, onChange) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      for (let i = 1; i <= 10; i++) {
        const btn = document.createElement('button');
        btn.className = 'sleep-btn' + (value === i ? ' active' : '');
        btn.textContent = i;
        btn.onclick = () => { onChange(i); renderAll(); };
        container.appendChild(btn);
      }
    }

    function createRatingButtons(containerId, value, onChange) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      for (let i = 1; i <= 10; i++) {
        const btn = document.createElement('button');
        btn.className = 'rating-btn' + (value === i ? ' active' : '');
        btn.textContent = i;
        btn.onclick = () => { onChange(i); renderAll(); };
        container.appendChild(btn);
      }
    }

    function createYesNoButtons(containerId, value, onChange) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      const yesBtn = document.createElement('button');
      yesBtn.className = 'yes-btn' + (value === true ? ' active' : '');
      yesBtn.textContent = 'Yes';
      yesBtn.onclick = () => { onChange(true); renderAll(); };
      const noBtn = document.createElement('button');
      noBtn.className = 'no-btn' + (value === false ? ' active' : '');
      noBtn.textContent = 'No';
      noBtn.onclick = () => { onChange(false); renderAll(); };
      container.appendChild(yesBtn);
      container.appendChild(noBtn);
    }

    function createDomainChips() {
      const container = document.getElementById('m-domains');
      const domains = ['Relational', 'Creative', 'Professional', 'Physical', 'Financial'];
      const colors = { Relational: '#ec4899', Creative: '#a855f7', Professional: '#3b82f6', Physical: '#22c55e', Financial: '#f59e0b' };
      container.innerHTML = '';
      domains.forEach(d => {
        const btn = document.createElement('button');
        const isActive = state.morning.domains.includes(d);
        btn.className = 'domain-chip' + (isActive ? ' active' : '');
        btn.textContent = d;
        btn.style.background = isActive ? colors[d] : '#f1f5f9';
        btn.onclick = () => {
          if (state.morning.domains.includes(d)) {
            state.morning.domains = state.morning.domains.filter(x => x !== d);
          } else {
            state.morning.domains.push(d);
          }
          saveState();
          renderAll();
        };
        container.appendChild(btn);
      });
    }

    function createWorkModeButtons() {
      const container = document.getElementById('n-workmode');
      const modes = ['teaching', 'admin', 'coaching', 'mixed', 'off'];
      container.innerHTML = '';
      modes.forEach(m => {
        const btn = document.createElement('button');
        btn.className = 'workmode-btn' + (state.nightly.workMode === m ? ' active' : '');
        btn.textContent = m;
        btn.onclick = () => { state.nightly.workMode = m; saveState(); renderAll(); };
        container.appendChild(btn);
      });
    }

    function createRepairStatusButtons() {
      const container = document.getElementById('n-repair-status');
      const statuses = ['Yes', 'No', 'Partial', 'N/A'];
      container.innerHTML = '';
      statuses.forEach(s => {
        const btn = document.createElement('button');
        btn.className = 'repair-btn' + (state.nightly.repairStatus === s ? ' active' : '');
        btn.textContent = s;
        btn.onclick = () => { state.nightly.repairStatus = s; saveState(); renderAll(); };
        container.appendChild(btn);
      });
    }

    // Bind inputs
    function bindInput(id, obj, key) {
      const el = document.getElementById(id);
      if (!el) return;
      el.value = obj[key] || '';
      el.oninput = () => { obj[key] = el.value; saveState(); };
    }

    function bindSelect(id, obj, key) {
      const el = document.getElementById(id);
      if (!el) return;
      el.value = obj[key] || '';
      el.onchange = () => { obj[key] = el.value; saveState(); };
    }

    // Render
    function renderAll() {
      // Tabs
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === state.activeTab));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('hidden', c.id !== state.activeTab + '-tab'));

      // Version toggles
      document.querySelectorAll('.version-btn').forEach(btn => {
        const target = btn.dataset.target;
        const version = btn.dataset.version;
        const isActive = (target === 'morning' && state.morningVersion === version) || (target === 'nightly' && state.nightlyVersion === version);
        btn.classList.toggle('active', isActive);
        if (target === 'morning') {
          btn.style.background = isActive ? 'linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)' : '#e2e8f0';
          btn.style.color = isActive ? 'white' : '#64748b';
        } else {
          btn.style.background = isActive ? 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)' : '#e2e8f0';
          btn.style.color = isActive ? 'white' : '#64748b';
        }
      });

      // Morning full sections
      document.getElementById('morning-full').classList.toggle('hidden', state.morningVersion !== 'full');
      document.getElementById('m-relational-section').classList.toggle('hidden', !state.morning.domains.includes('Relational'));
      document.getElementById('m-creative-section').classList.toggle('hidden', !state.morning.domains.includes('Creative'));
      document.getElementById('m-professional-section').classList.toggle('hidden', !state.morning.domains.includes('Professional'));
      document.getElementById('m-physical-section').classList.toggle('hidden', !state.morning.domains.includes('Physical'));
      document.getElementById('m-financial-section').classList.toggle('hidden', !state.morning.domains.includes('Financial'));

      // Nightly full sections
      document.getElementById('nightly-full').classList.toggle('hidden', state.nightlyVersion !== 'full');

      // Morning inputs
      bindInput('m-date', state.morning, 'date');
      bindSelect('m-day-of-week', state.morning, 'dayOfWeek');
      bindInput('m-woke-word', state.morning, 'wokeUpWord');
      bindInput('m-morning-pride', state.morning, 'morningPride');
      bindInput('m-one-thing', state.morning, 'oneThing');
      bindInput('m-action-item', state.morning, 'actionItem');
      bindInput('m-others', state.morning, 'others');
      bindInput('m-physical-sensation', state.morning, 'physicalSensation');
      bindInput('m-holding-tension', state.morning, 'holdingTension');
      bindInput('m-relational-present', state.morning, 'relationalPresent');
      bindInput('m-relational-plan', state.morning, 'relationalPlan');
      bindInput('m-creative-what', state.morning, 'creativeWhat');
      bindInput('m-creative-when', state.morning, 'creativeWhen');
      bindInput('m-professional-hardest', state.morning, 'professionalHardest');
      bindInput('m-professional-coast', state.morning, 'professionalCoast');
      bindInput('m-physical-asking', state.morning, 'physicalAsking');
      bindInput('m-physical-when', state.morning, 'physicalWhen');
      bindInput('m-financial-avoiding', state.morning, 'financialAvoiding');
      bindInput('m-financial-stewardship', state.morning, 'financialStewardship');
      bindInput('m-success', state.morning, 'success');
      bindInput('m-anchored', state.morning, 'anchored');
      bindInput('m-carry-forward', state.morning, 'carryForward');

      // Moment
      bindInput('moment-text', state.moment, 'text');

      // Nightly inputs
      bindInput('n-date', state.nightly, 'date');
      bindInput('n-day', state.nightly, 'dayOfWeek');
      bindInput('n-self-rating-notes', state.nightly, 'selfRatingNotes');
      bindInput('n-what-made-possible', state.nightly, 'whatMadeItPossible');
      bindInput('n-what-got-in-way', state.nightly, 'whatGotInTheWay');
      bindInput('n-sitting-with', state.nightly, 'sittingWithMe');
      bindInput('n-movement-type', state.nightly, 'movementType');
      bindInput('n-movement-duration', state.nightly, 'movementDuration');
      bindInput('n-movement-notes', state.nightly, 'movementNotes');
      bindInput('n-ate-well-notes', state.nightly, 'ateWellNotes');
      bindInput('n-mindfulness-notes', state.nightly, 'mindfulnessNotes');
      bindInput('n-physical-signals', state.nightly, 'physicalSignals');
      bindInput('n-teaching-notes', state.nightly, 'teachingNotes');
      bindInput('n-leadership-notes', state.nightly, 'leadershipNotes');
      bindInput('n-entrepreneurial-notes', state.nightly, 'entrepreneurialNotes');
      bindInput('n-product-updates', state.nightly, 'productUpdates');
      bindInput('n-energy-notes', state.nightly, 'energyNotes');
      bindInput('n-kids-notes', state.nightly, 'kidsNotes');
      bindInput('n-wife-notes', state.nightly, 'wifeNotes');
      bindInput('n-friend-who', state.nightly, 'friendWho');
      bindInput('n-friend-method', state.nightly, 'friendMethod');
      bindInput('n-music-notes', state.nightly, 'musicNotes');
      bindInput('n-writing-notes', state.nightly, 'writingNotes');
      bindInput('n-beautiful-notes', state.nightly, 'beautifulNotes');
      bindInput('n-lifted', state.nightly, 'liftedInteraction');
      bindInput('n-cost', state.nightly, 'costInteraction');
      bindInput('n-repair-timing', state.nightly, 'repairTiming');
      bindInput('n-repair-obstacle', state.nightly, 'repairObstacle');
      bindInput('n-prior-repairs', state.nightly, 'priorRepairs');

      // Sleep buttons (morning only now)
      createSleepButtons('m-sleep-btns', state.morning.sleepHours, v => { state.morning.sleepHours = v; saveState(); });

      // Rating buttons
      createRatingButtons('n-self-rating-btns', state.nightly.selfRating, v => { state.nightly.selfRating = v; saveState(); });
      createRatingButtons('n-ate-well-btns', state.nightly.ateWell, v => { state.nightly.ateWell = v; saveState(); });
      createRatingButtons('n-mindfulness-quality-btns', state.nightly.mindfulnessQuality, v => { state.nightly.mindfulnessQuality = v; saveState(); });
      createRatingButtons('n-teaching-btns', state.nightly.teachingConfidence, v => { state.nightly.teachingConfidence = v; saveState(); });
      createRatingButtons('n-leadership-btns', state.nightly.leadershipConfidence, v => { state.nightly.leadershipConfidence = v; saveState(); });
      createRatingButtons('n-entrepreneurial-btns', state.nightly.entrepreneurialConfidence, v => { state.nightly.entrepreneurialConfidence = v; saveState(); });
      createRatingButtons('n-energy-btns', state.nightly.energy, v => { state.nightly.energy = v; saveState(); });
      createRatingButtons('n-kids-btns', state.nightly.kidsPresence, v => { state.nightly.kidsPresence = v; saveState(); });
      createRatingButtons('n-wife-btns', state.nightly.wifePresence, v => { state.nightly.wifePresence = v; saveState(); });

      // Yes/No buttons
      createYesNoButtons('n-did-one-thing', state.nightly.didOneThing, v => { state.nightly.didOneThing = v; saveState(); });
      document.getElementById('n-one-thing-yes').classList.toggle('hidden', state.nightly.didOneThing !== true);
      document.getElementById('n-one-thing-no').classList.toggle('hidden', state.nightly.didOneThing !== false);

      createYesNoButtons('n-movement', state.nightly.movement, v => { state.nightly.movement = v; saveState(); });
      document.getElementById('n-movement-details').classList.toggle('hidden', state.nightly.movement !== true);

      createYesNoButtons('n-mindfulness', state.nightly.mindfulness, v => { state.nightly.mindfulness = v; saveState(); });
      document.getElementById('n-mindfulness-details').classList.toggle('hidden', state.nightly.mindfulness !== true);

      createYesNoButtons('n-friend', state.nightly.friendConnection, v => { state.nightly.friendConnection = v; saveState(); });
      document.getElementById('n-friend-details').classList.toggle('hidden', state.nightly.friendConnection !== true);
      bindInput('n-friend-heart', state.nightly, 'friendHeart');

      createYesNoButtons('n-music', state.nightly.musicProduction, v => { state.nightly.musicProduction = v; saveState(); });
      document.getElementById('n-music-notes-wrap').classList.toggle('hidden', state.nightly.musicProduction === null);

      createYesNoButtons('n-writing', state.nightly.writing, v => { state.nightly.writing = v; saveState(); });
      document.getElementById('n-writing-notes-wrap').classList.toggle('hidden', state.nightly.writing === null);

      createYesNoButtons('n-beautiful', state.nightly.capturedBeautiful, v => { state.nightly.capturedBeautiful = v; saveState(); });
      document.getElementById('n-beautiful-notes-wrap').classList.toggle('hidden', state.nightly.capturedBeautiful === null);

      // Repair status buttons and conditional fields
      createRepairStatusButtons();
      document.getElementById('n-repair-when-wrap').classList.toggle('hidden', state.nightly.repairStatus !== 'Yes' && state.nightly.repairStatus !== 'Partial');
      document.getElementById('n-repair-blocker-wrap').classList.toggle('hidden', state.nightly.repairStatus !== 'No');

      // Domains and work mode
      createDomainChips();
      createWorkModeButtons();
      
      // Hide teaching/leadership fields when work mode is "off"
      const professionalFields = document.getElementById('n-professional-fields');
      if (professionalFields) {
        professionalFields.classList.toggle('hidden', state.nightly.workMode === 'off');
      }
    }

    // Generate output
    function generateMorningOutput() {
      let o = `Daily Morning Intention Practice\n\n**CORE**\n\n*Grounding*\n`;
      o += `- Date: ${state.morning.date}\n`;
      o += `- Day of the Week: ${state.morning.dayOfWeek || '(not selected)'}\n`;
      o += `- Hours of sleep: ${state.morning.sleepHours}\n`;
      o += `- One word for how I woke up: ${state.morning.wokeUpWord || '(not entered)'}\n`;
      if (state.morning.morningPride) o += `- Already proud of or grateful for: ${state.morning.morningPride}\n`;
      o += `\n*Orientation*\n`;
      o += `- What domain is asking for my attention today? ${state.morning.domains.length > 0 ? state.morning.domains.join(', ') : '(none selected)'}\n`;
      o += `- **What's the ONE specific thing that, if I do it, makes today a win?** ${state.morning.oneThing || '(not entered)'}\n`;
      o += `- **What action/calendar item emerged from this reflection?** ${state.morning.actionItem || '(not entered)'}\n`;
      if (state.morning.others) o += `- What else is present? ${state.morning.others}\n`;
      
      if (state.morningVersion === 'full') {
        o += `\n---\n\n**FULL VERSION**\n\n*Body Awareness*\n`;
        o += `- Physical sensation right now: ${state.morning.physicalSensation || '(not entered)'}\n`;
        o += `- Where am I holding tension? ${state.morning.holdingTension || '(not entered)'}\n`;
        
        if (state.morning.domains.includes('Relational')) {
          o += `\n*Relational*\n`;
          o += `- Who needs me present, and what does present look like? ${state.morning.relationalPresent || '(not entered)'}\n`;
          o += `- What's most likely to pull me out, and my plan? ${state.morning.relationalPlan || '(not entered)'}\n`;
        }
        if (state.morning.domains.includes('Creative')) {
          o += `\n*Creative*\n`;
          o += `- What do I want to make/capture/move forward? ${state.morning.creativeWhat || '(not entered)'}\n`;
          o += `- When will I protect time for it? ${state.morning.creativeWhen || '(not entered)'}\n`;
        }
        if (state.morning.domains.includes('Professional')) {
          o += `\n*Professional*\n`;
          o += `- Where is curiosity asking me to lean in today? ${state.morning.professionalHardest || '(not entered)'}\n`;
          o += `- Where could I coast but won't? ${state.morning.professionalCoast || '(not entered)'}\n`;
        }
        if (state.morning.domains.includes('Physical')) {
          o += `\n*Physical*\n`;
          o += `- What's my body asking for? ${state.morning.physicalAsking || '(not entered)'}\n`;
          o += `- Intentional movement‚Äîwhat and when? ${state.morning.physicalWhen || '(not entered)'}\n`;
        }
        if (state.morning.domains.includes('Financial')) {
          o += `\n*Financial*\n`;
          o += `- What money-related action have I been avoiding? ${state.morning.financialAvoiding || '(not entered)'}\n`;
          o += `- What would stewardship look like today? ${state.morning.financialStewardship || '(not entered)'}\n`;
        }
        o += `\n*Anticipation*\n`;
        o += `- Where do I see myself being successful today? ${state.morning.success || '(not entered)'}\n`;
        o += `- What will help me stay anchored? ${state.morning.anchored || '(not entered)'}\n`;
        if (state.morning.carryForward) o += `\n*Carry Forward*\n- From last night: ${state.morning.carryForward}\n`;
      }
      return o;
    }

    function generateMomentOutput() {
      return `Moment capture: ${state.moment.text}`;
    }

    function generateNightlyOutput() {
      let o = `Daily Nightly Reflection Practice\n\n**CORE**\n`;
      o += `- Date: ${state.nightly.date}\n`;
      o += `- Day of week: ${state.nightly.dayOfWeek}\n\n`;
      o += `- **Showed up as the version of myself I want to be (1-10):** ${state.nightly.selfRating}\n`;
      o += `- Notes: ${state.nightly.selfRatingNotes || '(none)'}\n\n`;
      o += `- **Did I do the ONE thing I named this morning?** ${state.nightly.didOneThing === true ? 'Yes' : state.nightly.didOneThing === false ? 'No' : '(not answered)'}\n`;
      if (state.nightly.didOneThing === true) o += `- **What made it possible?** ${state.nightly.whatMadeItPossible || '(not entered)'}\n`;
      else if (state.nightly.didOneThing === false) o += `- **What got in the way?** ${state.nightly.whatGotInTheWay || '(not entered)'}\n`;
      o += `\n- **One sentence‚Äîwhat's sitting with me tonight?** ${state.nightly.sittingWithMe || '(not entered)'}\n`;

      if (state.nightlyVersion === 'full') {
        o += `\n---\n\n**FULL VERSION**\n\n*Body Check*\n`;
        o += `- Intentional movement? ${state.nightly.movement === true ? 'Yes' : state.nightly.movement === false ? 'No' : '(not answered)'}`;
        if (state.nightly.movement === true) {
          o += ` | Type: ${state.nightly.movementType || '‚Äî'} | Duration: ${state.nightly.movementDuration || '‚Äî'}`;
          if (state.nightly.movementNotes) o += `\n  Notes: ${state.nightly.movementNotes}`;
        }
        o += `\n- Ate well today? (1-10): ${state.nightly.ateWell}`;
        if (state.nightly.ateWellNotes) o += ` | Notes: ${state.nightly.ateWellNotes}`;
        o += `\n- Mindfulness practice? ${state.nightly.mindfulness === true ? 'Yes' : state.nightly.mindfulness === false ? 'No' : '(not answered)'}`;
        if (state.nightly.mindfulness === true) {
          o += ` | Quality (1-10): ${state.nightly.mindfulnessQuality}`;
          if (state.nightly.mindfulnessNotes) o += `\n  Notes: ${state.nightly.mindfulnessNotes}`;
        }
        o += `\n- Physical signals: ${state.nightly.physicalSignals || '(none noted)'}\n`;

        o += `\n*Professional Confidence*\n`;
        o += `- Work mode: ${state.nightly.workMode || '(not selected)'}\n`;
        if (state.nightly.workMode !== 'off') {
          o += `- Teaching confidence (1-10): ${state.nightly.teachingConfidence}`;
          if (state.nightly.teachingNotes) o += ` | Notes: ${state.nightly.teachingNotes}`;
          o += `\n- Leadership confidence (1-10): ${state.nightly.leadershipConfidence}`;
          if (state.nightly.leadershipNotes) o += ` | Notes: ${state.nightly.leadershipNotes}`;
          o += '\n';
        }

        o += `\n*Entrepreneurial*\n`;
        o += `- Entrepreneurial confidence (1-10): ${state.nightly.entrepreneurialConfidence}`;
        if (state.nightly.entrepreneurialNotes) o += ` | Notes: ${state.nightly.entrepreneurialNotes}`;
        if (state.nightly.productUpdates) o += `\n- Product Updates: ${state.nightly.productUpdates}`;

        o += `\n\n*Relational Presence*\n`;
        o += `- Energy (1-10): ${state.nightly.energy}`;
        if (state.nightly.energyNotes) o += ` | Notes: ${state.nightly.energyNotes}`;
        o += `\n- Presence, patience, playfulness with kids (1-10): ${state.nightly.kidsPresence}`;
        if (state.nightly.kidsNotes) o += ` | Notes: ${state.nightly.kidsNotes}`;
        o += `\n- Present and intentionally curious with wife (1-10): ${state.nightly.wifePresence}`;
        if (state.nightly.wifeNotes) o += ` | Notes: ${state.nightly.wifeNotes}`;
        o += `\n- Connected with a friend? ${state.nightly.friendConnection === true ? 'Yes' : state.nightly.friendConnection === false ? 'No' : '(not answered)'}`;
        if (state.nightly.friendConnection === true) {
          o += ` | Who: ${state.nightly.friendWho || '‚Äî'} | Method: ${state.nightly.friendMethod || '‚Äî'}`;
          if (state.nightly.friendHeart) o += `\n  Heart of the conversation: ${state.nightly.friendHeart}`;
        }

        o += `\n\n*Passion Pursuits*\n`;
        o += `- Music production? ${state.nightly.musicProduction === true ? 'Yes' : state.nightly.musicProduction === false ? 'No' : '(not answered)'}`;
        if (state.nightly.musicNotes) o += ` | Notes: ${state.nightly.musicNotes}`;
        o += `\n- Writing? ${state.nightly.writing === true ? 'Yes' : state.nightly.writing === false ? 'No' : '(not answered)'}`;
        if (state.nightly.writingNotes) o += ` | Notes: ${state.nightly.writingNotes}`;
        o += `\n- Captured something beautiful? ${state.nightly.capturedBeautiful === true ? 'Yes' : state.nightly.capturedBeautiful === false ? 'No' : '(not answered)'}`;
        if (state.nightly.beautifulNotes) o += ` | Notes: ${state.nightly.beautifulNotes}`;

        o += `\n\n*Interactions*\n`;
        o += `- One interaction that lifted me (+ who): ${state.nightly.liftedInteraction || '(not entered)'}\n`;
        o += `- One that cost me (+ who): ${state.nightly.costInteraction || '(not entered)'}\n`;
        if (state.nightly.repairStatus) {
          o += `- Repaired? ${state.nightly.repairStatus}`;
          if ((state.nightly.repairStatus === 'Yes' || state.nightly.repairStatus === 'Partial') && state.nightly.repairTiming) {
            o += ` | When: ${state.nightly.repairTiming}`;
          }
          if (state.nightly.repairStatus === 'No' && state.nightly.repairObstacle) {
            o += `\n  What's in the way: ${state.nightly.repairObstacle}`;
          }
          o += '\n';
        }
        if (state.nightly.priorRepairs) o += `- Prior repairs completed: ${state.nightly.priorRepairs}\n`;
      }
      return o;
    }

    // Clear
    function clearCurrentForm() {
      const fresh = getDateInfo();
      if (state.activeTab === 'morning') {
        state.morning = { date: fresh.formatted, dayOfWeek: fresh.dayOfWeek, sleepHours: 7, wokeUpWord: '', morningPride: '', domains: [], oneThing: '', actionItem: '', others: '', physicalSensation: '', holdingTension: '', relationalPresent: '', relationalPlan: '', creativeWhat: '', creativeWhen: '', professionalHardest: '', professionalCoast: '', physicalAsking: '', physicalWhen: '', financialAvoiding: '', financialStewardship: '', success: '', anchored: '', carryForward: '' };
      } else if (state.activeTab === 'moment') {
        state.moment = { text: '' };
      } else {
        state.nightly = { date: fresh.formatted, dayOfWeek: fresh.dayOfWeek, selfRating: 7, selfRatingNotes: '', didOneThing: null, whatMadeItPossible: '', whatGotInTheWay: '', sittingWithMe: '', movement: null, movementType: '', movementDuration: '', movementNotes: '', ateWell: 7, ateWellNotes: '', mindfulness: null, mindfulnessQuality: 7, mindfulnessNotes: '', physicalSignals: '', workMode: '', teachingConfidence: 7, teachingNotes: '', leadershipConfidence: 7, leadershipNotes: '', entrepreneurialConfidence: 7, entrepreneurialNotes: '', productUpdates: '', energy: 7, energyNotes: '', kidsPresence: 7, kidsNotes: '', wifePresence: 7, wifeNotes: '', friendConnection: null, friendWho: '', friendMethod: '', friendHeart: '', musicProduction: null, musicNotes: '', writing: null, writingNotes: '', capturedBeautiful: null, beautifulNotes: '', liftedInteraction: '', costInteraction: '', repairStatus: '', repairTiming: '', repairObstacle: '', priorRepairs: '' };
      }
      saveState();
      renderAll();
    }

    // Event listeners
    document.querySelectorAll('.tab').forEach(tab => {
      tab.onclick = () => { state.activeTab = tab.dataset.tab; saveState(); renderAll(); };
    });

    document.querySelectorAll('.version-btn').forEach(btn => {
      btn.onclick = () => {
        if (btn.dataset.target === 'morning') state.morningVersion = btn.dataset.version;
        else state.nightlyVersion = btn.dataset.version;
        saveState();
        renderAll();
      };
    });

    let showConfirm = false;
    document.getElementById('clear-btn').onclick = () => {
      showConfirm = true;
      document.getElementById('footer-buttons').classList.add('hidden');
      document.getElementById('footer-confirm').classList.remove('hidden');
    };
    document.getElementById('cancel-btn').onclick = () => {
      showConfirm = false;
      document.getElementById('footer-buttons').classList.remove('hidden');
      document.getElementById('footer-confirm').classList.add('hidden');
    };
    document.getElementById('confirm-btn').onclick = () => {
      clearCurrentForm();
      showConfirm = false;
      document.getElementById('footer-buttons').classList.remove('hidden');
      document.getElementById('footer-confirm').classList.add('hidden');
    };

    document.getElementById('copy-btn').onclick = () => {
      let output = '';
      if (state.activeTab === 'morning') output = generateMorningOutput();
      else if (state.activeTab === 'moment') output = generateMomentOutput();
      else output = generateNightlyOutput();
      
      navigator.clipboard.writeText(output).then(() => {
        const btn = document.getElementById('copy-btn');
        btn.textContent = '‚úì Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'üìã Copy to Clipboard';
          btn.classList.remove('copied');
        }, 2000);
      });
    };

    // Initialize
    loadState();
    renderAll();
  </script>
</body>
</html>
